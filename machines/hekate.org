#+PROPERTY: header-args :tangle yes
* hekate
** Preamble
#+BEGIN_SRC nix
  { hekate = { config, pkgs, ... }:
  let
    baseconfig = { allowUnfree = true; };
    unstable = import <nixos-unstable> { config = baseconfig; };
  in
  {
    imports = [
      <nixos-unstable/nixos/modules/services/misc/jackett.nix>
      ../home-manager/nixos
      ../modules/common.nix
    ];

    disabledModules = [
      "services/misc/jackett.nix"
    ];

    nixpkgs.config = baseconfig // {
      packageOverrides = pkgs: {
        jackett = unstable.jackett;
      };
    };
#+END_SRC
** Configuration
*** GNOME
#+BEGIN_SRC nix
  services.xserver.enable = true;
  services.xserver.displayManager.gdm.enable = true;
  services.xserver.desktopManager.gnome3.enable = true;
#+END_SRC
*** GnuPG
#+BEGIN_SRC nix
  programs.gnupg.agent = {
    enable = true;
    enableSSHSupport = true;
    pinentryFlavor = "gnome3";
  };
#+END_SRC
*** Home
**** Preamble
#+BEGIN_SRC nix
  home-manager.users.me = {
#+END_SRC
**** dconf
#+BEGIN_SRC nix
  dconf.settings = {
    "org/gnome/desktop/input-sources" = {
      xkb-options = [ "caps:ctrl_modifier" ];
    };

    "org/gnome/desktop/interface" = {
      enable-animations = false;
      gtk-key-theme = "Emacs";
      gtk-theme = "Adapta-Eta";
      icon-theme = "Paper";
      monospace-font-name = "Monoid Light Semi-Condensed 9";
    };

    "org/gnome/desktop/notifications" = {
      show-in-lock-screen = false;
    };

    "org/gnome/desktop/search-providers" = {
      disable-external = true;
    };

    "org/gnome/desktop/sound" = {
      allow-volume-above-100-percent = true;
    };

    "org/gnome/desktop/wm/preferences" = {
      resize-with-right-button = true;
    };

    "org/gnome/shell" = {
      enabled-extensions = [
        "alt-tab-raise-first-window@system76.com"
        "caffeine@patapon.info"
        "dash-to-dock@micxgx.gmail.com"
        "middleclickclose@paolo.tranquilli.gmail.com"
        "nasa_apod@elinvention.ovh"
        "no-title-bar@jonaspoehler.de"
        "openweather-extension@jenslody.de"
        "refresh-wifi@kgshank.net"
        "tweaks-system-menu@extensions.gnome-shell.fifi.org"
        "user-theme@gnome-shell-extensions.gcampax.github.com"
        "windowoverlay-icons@sustmidown.centrum.cz"
      ];
    };

    "org/gnome/shell/extensions/dash-to-dock" = {
      background-opacity = 0.6;
      dash-max-icon-size = 32;
      dock-fixed = true;
      extend-height = true;
      running-indicator-dominant-color = true;
      running-indicator-style = "SQUARES";
      scroll-action = "switch-workspace";
      show-mounts = false;
      show-trash = false;
      transparency-mode = "FIXED";
    };

    "org/gnome/shell/extensions/nasa-apod" = {
      hide = true;
    };

    "org/gnome/shell/extensions/no-title-bar" = {
      button-position = "hidden";
    };

    "org/gnome/shell/extensions/openweather" = {
      city = "46.0102989,15.3016229>Sevnica, Slovenija >-1";
      days-forecast = 3;
      pressure-unit = "hPa";
      unit = "celsius";
      wind-speed-unit = "kph";
    };

    "org/gnome/shell/extensions/user-theme" = {
      name = "Adapta-Nokto-Eta";
    };

    "org/gnome/shell/extensions/windowoverlay-icons" = {
      icon-opacity-blur = 255;
      icon-size = 50;
      icon-size-relative = true;
    };

    "org/gnome/system/locale" = {
      region = "sl_SI.UTF-8";
    };
  };
#+END_SRC
**** Packages
#+BEGIN_SRC nix
  home.packages = with pkgs; [
    adapta-gtk-theme
    apg
    bitwarden
    colordiff
    discord
    dnsutils
    easyrsa
    emacs
    feedreader
    file
    firefox
    fzf
    git
    git-secret
    gnome3.evolution
    gnome3.geary
    gnome3.gnome-tweak-tool
    gnomeExtensions.alt-tab-raise-first-window
    gnomeExtensions.caffeine
    gnomeExtensions.dash-to-dock
    gnomeExtensions.gsconnect
    gnomeExtensions.middleclickclose
    gnomeExtensions.nasa-apod
    gnomeExtensions.no-title-bar
    gnomeExtensions.openweather
    gnomeExtensions.refresh-wifi
    gnomeExtensions.tweaks-system-menu
    gnomeExtensions.windowoverlay-icons
    hexchat
    htop
    irssi
    mc
    monoid
    ncdu
    networkmanagerapplet
    nfs-utils
    nixops
    nmap
    openssl
    paper-icon-theme
    silver-searcher
    steam
    tdesktop
    tilix
    traceroute
    transmission-remote-gtk
    unzip
    vim
    wget
  ];
#+END_SRC
**** Services
***** Parcellite
#+BEGIN_SRC nix
  services.parcellite.enable = true;
#+END_SRC
***** Redshift
#+BEGIN_SRC nix
  services.redshift = {
    enable = true;
    latitude = "46.01";
    longitude = "15.30";
    temperature = {
      day = 5500;
      night = 4700;
    };
  };
#+END_SRC
**** Epilogue
#+BEGIN_SRC nix
  };
#+END_SRC
*** Networking
#+BEGIN_SRC nix
  networking.useDHCP = false;
  networking.interfaces.wlp4s0.useDHCP = true;
#+END_SRC
**** Firewall
#+BEGIN_SRC nix
  networking.firewall = {
    allowedTCPPorts = [
      9117                        # jackett
    ];

    allowedTCPPortRanges = [
      { from = 1714; to = 1764; } # gsconnect
    ];

    allowedUDPPortRanges = [
      { from = 1714; to = 1764; } # gsconnect
    ];
  };
#+END_SRC
**** Hostname
#+BEGIN_SRC nix
  networking.hostName = "hekate";
#+END_SRC
*** Services
**** Jackett
#+BEGIN_SRC nix
  services.jackett.enable = true;
#+END_SRC
**** OpenSSH
#+BEGIN_SRC nix
  services.openssh.enable = true;
#+END_SRC
*** Steam Support
#+BEGIN_SRC nix
  hardware.opengl.driSupport32Bit = true;
  hardware.pulseaudio.support32Bit = true;
#+END_SRC
*** User
#+BEGIN_SRC nix
  users.users.me = {
    isNormalUser = true;
    extraGroups = [ "wheel" ];
  };
#+END_SRC
** Epilogue
#+BEGIN_SRC nix
      system.stateVersion = "20.03";
    };
  }
#+END_SRC
